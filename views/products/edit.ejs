<%- include('../partials/head', { title: 'Editar Producto - ' + product.name }) %>
<%- include('../partials/header', { user, cartCount }) %>

<main class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h2 class="h5 mb-0">Editar Producto: <%= product.name %></h2>
                </div>
                <div class="card-body">
                    <form action="/products/<%= product.id %>?_method=PUT" method="POST" enctype="multipart/form-data">
                        <input type="hidden" name="_method" value="PUT">

                        <div class="mb-3">
                            <label for="name" class="form-label">Nombre del Producto *</label>
                            <input type="text" class="form-control" id="name" name="name" value="<%= product.name %>" required>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Descripción *</label>
                            <textarea class="form-control" id="description" name="description" rows="3" required><%= product.description %></textarea>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="category" class="form-label">Categoría *</label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="panaderia" <%= product.category === 'panaderia' ? 'selected' : '' %>>Panadería</option>
                                    <option value="frutas" <%= product.category === 'frutas' ? 'selected' : '' %>>Frutas y Verduras</option>
                                    <option value="lacteos" <%= product.category === 'lacteos' ? 'selected' : '' %>>Lácteos</option>
                                    <option value="comida-preparada" <%= product.category === 'comida-preparada' ? 'selected' : '' %>>Comida Preparada</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="restaurant" class="form-label">Comercio *</label>
                                <input type="text" class="form-control" id="restaurant" name="restaurant" value="<%= product.restaurant %>" required>
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="originalPrice" class="form-label">Precio Original ($) *</label>
                                <input type="number" step="0.01" class="form-control" id="originalPrice" name="originalPrice" value="<%= product.originalPrice %>" required>
                            </div>
                            <div class="col-md-6">
                                <label for="price" class="form-label">Precio de Rescate ($) *</label>
                                <input type="number" step="0.01" class="form-control" id="price" name="price" value="<%= product.price %>" required>
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="stock" class="form-label">Cantidad Disponible *</label>
                                <input type="number" class="form-control" id="stock" name="stock" value="<%= product.stock %>" required>
                            </div>
                            <div class="col-md-6">
                                <label for="pickupTime" class="form-label">Horario de Recogida *</label>
                                <input type="text" class="form-control" id="pickupTime" name="pickupTime" value="<%= product.pickupTime %>" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Imagen Actual</label>
                            <div class="mb-2">
                                <img src="/images/products/<%= product.image %>" alt="<%= product.name %>" class="img-thumbnail" style="max-height: 150px;">
                            </div>
                            <label for="image" class="form-label">Cambiar Imagen</label>
                            <input type="file" class="form-control" id="image" name="image" accept="image/*">
                            <div class="form-text">Dejar vacío para mantener la imagen actual</div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <a href="/products/<%= product.id %>" class="btn btn-outline-secondary me-md-2">Cancelar</a>
                            <button type="submit" class="btn btn-primary me-md-2">Actualizar Producto</button>
                            <a href="/products/<%= product.id %>/delete" class="btn btn-danger" onclick="return confirm('¿Estás seguro de querer eliminar este producto?')">Eliminar</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<%- include('../partials/footer') %>
